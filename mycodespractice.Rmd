---
title: "mycodebookpractice"
output: html_document
date: "2025-09-30"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, load packages}
library(tidyverse)
library(summarytools)
library(survey)
```

```{r, load data}
load("~/code/NSDUH_2023.Rdata")
library(readr)
```

```{r, renaming}
 d <-"~/code/NSDUH_2023.Rdata"

 vars <-as_tibble(colnames(d))
```

#variables of interest, WHAT AGES DO RANGES ACTUALLY CORRELATE TO?
#participant ID: QUESTID2
#soft drugs: IRCIGAGE, IRNICVAPAGE, IRSMKLSSTRY, IRCGRAGE, IRALCAGE, IRMJAGE, 991=NEVER USED
#hard drugs: IRCOCAGE, IRHERAGE, IRMETHAMAGE, IRHALLUCAGE, 991=NEVER USED 
#youth experiences aka suicidal thoughts in past year: YUSUITHKYR, .=18+/UNK, 1=YES, 2=NO, 3=IDK, 4=REFUSED
#adult depression aka mde in lifetime: AMDELT, .=-18/UNK, 1=YES, 2=NO
#adolescent depression on pg 504



#subset to <17, use if ever try not age at first try, use all sub categories for having tried any drug, then most commonly exposed to 
#get variables of interest, keep ID in 
#make composite variable of all ever used...if alc ever==1 or | cigever
#look for potential confounders: age, race, ethnicity, household inc/ses, sex, grades in school, measure of anxienty?, parental monitoring
#two descriptive tables, one of demo characteristics, other of presence of mde and substance use
#then logistic regression to see if relationship

#start new with complete data management then send off

#for confounder, "a var that is related to exp and out but not in causal pathway" chi square with each confounder and exp and then with outcome, anywhere sig for both then considered a confounder, in many confounder then chunked with what happens earlier in time then later in time, later in time is more modifiable. "age, race, sex" what is significant then carried into next model, then look at social factors
#crude model then multiple adjusted models as we account for each

#lit review tenish , what confounders do they control for? can help determine my candidate confounders, and common sense of what gets in way of relationship
#use MeSH database, add to search buiilder, 2000-2025 or last 5 years, observational studies, okay review/systematic review, 



```{r, new data with vars of interest}
 s <- data %>%
   select(c(QUESTID2, IRCIGAGE, IRNICVAPAGE, IRSMKLSSTRY, IRCGRAGE, IRALCAGE, IRMJAGE, IRCOCAGE, IRHERAGE, IRMETHAMAGE, IRHALLUCAGE))
```

```{r, freq}
 freq(s$CIGTRY)
```

```{r, mean}
mean(s$CIGTRY)
```

```{r, median}
median(s$CIGTRY)
```

```{r, glimpse dataset}
glimpse(s)
```

```{r, cigtry-safe-recode}
#i dont think i like this...

# Safely coerce CIGTRY to numeric and keep only ages 1..65, then compute median and show counts
library(dplyr)

# prefer `s` if it exists (your analytic subset), otherwise use `d`
df_for_cig <- if (exists('s')) s else d

df_for_cig <- df_for_cig %>%
  mutate(CIGTRY_num = suppressWarnings(as.numeric(as.character(CIGTRY)))) %>%
  mutate(CIGTRY_clean = ifelse(CIGTRY_num >= 1 & CIGTRY_num <= 65, CIGTRY_num, NA_real_))

summary_tbl <- df_for_cig %>% summarise(
  total = n(),
  valid_1_65 = sum(!is.na(CIGTRY_clean)),
  median_1_65 = median(CIGTRY_clean, na.rm = TRUE)
)

print(summary_tbl)

cat('\nDistinct original CIGTRY codes and counts (top 50):\n')
print(head(sort(table(df_for_cig$CIGTRY_num), decreasing = TRUE), 50))

```

```{r, recode 991 to missing}

df_recoded <- df %>%
  mutate(IRCIGAGE = if_else(IRCIGAGE == 991, NA_integer_, IRCIGAGE))

print(df_recoded)
#>   ID IRCIGAGE
#> 1  1       15
#> 2  2       17
#> 3  3       NA
#> 4  4       14
#> 5  5       NA
#> 6  6       18

```

```{r, recode 991 to missing}
#attempt on IRCIGAGE, success, 

s_recoded <- s %>%
  mutate(IRCIGAGE = if_else(IRCIGAGE == 991, NA_integer_, IRCIGAGE))

print(s_recoded)

```

```{r, recode 991 to missing}
#attempt on all vars, 
#You can give across() a vector of the exact variable names you want to change. The ~ (tilde) creates a mini-function where .x stands in for each variable as it's being processed.
# List of variables to recode

vars_to_recode <- c("IRCIGAGE", "IRNICVAPAGE", "IRSMKLSSTRY", "IRCGRAGE", 
                    "IRALCAGE", "IRMJAGE", "IRCOCAGE", "IRHERAGE", 
                    "IRMETHAMAGE", "IRHALLUCAGE")

# Use across() to apply the same rule to all variables in the list
# The 'all_of()' function helps select columns from a character vector

s_recoded <- s %>%
  mutate(across(all_of(vars_to_recode), ~ if_else(.x == 991, NA_integer_, .x)))

print(s_recoded)

```

```{r, mean of s_recoded var}

#To calculate the average of a variable while ignoring the missing (NA) values, you use the argument na.rm = TRUE inside the mean() function.

# Calculate the mean of IRCIGAGE, removing NA values
summary_stats <- s_recoded %>%
  summarise(avg_cig_age = mean(IRCIGAGE, na.rm = TRUE))

print(summary_stats)

```
```{r, mean of all s_recoded vars}

means_of_all <- c("IRCIGAGE", "IRNICVAPAGE", "IRSMKLSSTRY", "IRCGRAGE", 
                    "IRALCAGE", "IRMJAGE", "IRCOCAGE", "IRHERAGE", 
                    "IRMETHAMAGE", "IRHALLUCAGE")

summary_stats <- s_recoded %>%
  summarise(across(all_of(means_of_all), ~ if_else(.x == 991, NA_integer_, .x)))
mean(IRCIGAGE, na.rm = TRUE

print(summary_stats)



